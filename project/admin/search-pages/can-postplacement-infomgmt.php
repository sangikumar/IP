<?php/** * Preliminary Information gathering bt=y candidate post placement * User: Shilpi * Date: 2/13/2015 * Time: 4:41 PM */require_once("../models/config.php");include_once ("../../ip-config.php");if (!securePage($_SERVER['PHP_SELF'])){die();}$userId = $loggedInUser->user_id;$candidateID = $loggedInUser->candidateid;if(!userIdExists($userId)){    header("Location:login.php"); die();}?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns='http://www.w3.org/1999/xhtml'><head>    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />    <title>Work Information Management</title>    <script src='models/funcs.js' type='text/javascript'></script>    <link rel='stylesheet' href='http://code.jquery.com/ui/1.10.3/themes/start/jquery-ui.css' />    <link rel='stylesheet' type='text/css' media='screen' href='/project/themes/ui.jqgrid.css'  />    <link rel='stylesheet' type='text/css' media='screen' href='/project/themes/ui.multiselect.css'/>    <link href='models/site-templates/default.css' rel='stylesheet' type='text/css' />    <link rel='stylesheet' href='http://gregfranko.com/jquery.selectBoxIt.js/css/jquery.selectBoxIt.css' />    <script src='http://code.jquery.com/jquery-1.9.1.js'></script>    <script src='http://code.jquery.com/ui/1.10.3/jquery-ui.js'></script>    <script src='exam/js/i18n/grid.locale-en.js' type='text/javascript'></script>    <script src='models/funcs.js'  type='text/javascript'></script>    <script src='http://gregfranko.com/jquery.selectBoxIt.js/js/jquery.selectBoxIt.min.js'></script>    <script src='exam/js/jquery.jqGrid.min.js' type='text/javascript'></script>    <script type="text/javascript" src="http://innova-path.com/project/myjs/jHtmlArea-0.8.js"></script>    <link rel="Stylesheet" type="text/css" href="mystyle/jHtmlArea.css" />    <script>   $(function() {            $( '#mymenu' ).menu();            $('input').addClass('ui-corner-all');   });    </script>    <style>  .ui-menu { width: 130px; }  </style>    <script type='text/javascript'>        //<![CDATA[        $(document).ready(function(){            $('.link').button();            $('#mymenu').menu();            $('select').selectBoxIt();            $('input').addClass("ui-corner-all");            $('#form1').validate();        });        //]]>    </script></head><body><div id='wrapper'>    <div id='top'><div id='logo'></div><div id='logo1'></div></div>    <div id='content'>        <h2>Information Management</h2>        <br />        <div id='left-nav'>            <?php            include($_SERVER["DOCUMENT_ROOT"] ."left-nav.php");            ?>        </div>        <div id='main'>            <?php            switch($_SERVER['REQUEST_METHOD'])            {                case 'GET' : // get candidate's basic info                             $query1 = "select name,email,phone from candidate where candidateid = " . $candidateID;                             if (!($results1 = $mysqli->query($query1))) {                                    echo '<div class="error">DB Error- Unable to fetch Candidate Data :'.$mysqli->error.'</div>';                                    die;                             }                             $rows1 = $results1->fetch_assoc();                             // get candidate's active placement id                             $query2 = "select id from placement where candidateid=".$candidateID." and status = '0Active'";                             if (!($results2 = $mysqli->query($query2))) {                                 echo '<div class="error">DB Error Query2- Unable to fetch Candidate Placement Data :'.$mysqli->error.'</div>';                                 die;                             }                             $rows2 = $results2->fetch_assoc();                             // check if candidate already updated work info in intermediary table                             $query3 = "select placementid, wrkdesignation, wrkemail, wrkphone,wrkstreetaddress,wrkcity,wrkstate,wrkzip, mgrname, mgremail, mgrphone,                              hiringmgrname, hiringmgremail, hiringmgrphone, projectname, projectdesc, approved from candidateupdatedplacementinfo where candidateid = ".                              $candidateID. " and placementid = ".$rows2['id'];                             $results3 = $mysqli->query($query3);                             if (!$results3) {                                echo '<div class="error">DB Error Query3- Unable to fetch Candidate Data from Intermediary Table :'.$mysqli->error.'</div>';                                die;                             }                             $numrows = $results3->num_rows;                             $rows3 = $results3->fetch_assoc();                             // get candidate info from placement table                             $query4 = "select wrkdesignation, wrkemail, wrklocation, wrkphone,  mgrname, mgremail, mgrphone,                              hiringmgrname, hiringmgremail, hiringmgrphone, projectname, projectdesc from placement where candidateid = ".                                 $candidateID. " and id = ".$rows2['id'];                             $results4 = $mysqli->query($query4);                             if (!$results4) {                                 echo '<div class="error">DB Error Query4- Unable to fetch Candidate Data from Placement Table :'.$mysqli->error.'</div>';                                 die;                             }                             $rows4 = $results4->fetch_assoc();                             if($numrows > 0) {                                 $rows = $rows3;                                 if ($rows3['approved'] == 'N') {                                     echo '<div class="error">The information entered is either incomplete or yet to be approved by Admin.</div>';                                 }                             }                             else {                                 $rows = $rows4;                             }                             break;                case 'POST': $wrkdesignation = $_POST['designation'];                             $wrkemail = $_POST['wrkemail'];                             $wrkphone = $_POST['wrkphone'];                             $wrkstreetaddress = $_POST['wrkstreetaddress'];                             $wrkcity = $_POST['wrkcity'];                             $wrkstate = $_POST['wrkstate'];                             $wrkzip = $_POST['wrkzip'];                             $mgrname = $_POST['mgrname'];                             $mgremail = $_POST['mgremail'];                             $mgrphone = $_POST['mgrphone'];                             $hiringmgrname = $_POST['hiringmgrname'];                             $hiringmgrphone = $_POST['hiringmgrphone'];                             $hiringmgremail = $_POST['hiringmgremail'];                             $projectname = $_POST['projectname'];                             $projectdesc = $_POST['projectdesc'];                             $trainingfb = $_POST['trainingfb'];                             if (trim($wrkdesignation) == "" || trim($wrkemail) == ""                                 || trim($wrkphone) == ""|| trim($wrkstreetaddress) == ""                                 || trim($wrkcity) == ""|| trim($wrkstate) == ""                                 || trim($wrkzip) == ""                                 || trim($mgrname) == ""|| trim($mgremail) == ""                                 || trim($mgrphone) == "" || trim($hiringmgrname) == ""                                 || trim($hiringmgrphone) == "" || trim($hiringmgremail == "")                                 || trim($projectname)  == ""|| trim($projectdesc) == ""){                                 echo '<div class="error">Please fill the missing information.</div>';                                 die;                             }                             else {                                // get placementid for the candidate's active placement                                $query5 = "select id from placement p where p.candidateid =".$candidateID." and status = '0Active'";                                $results5 = $mysqli->query($query5);                                if (!$results5 ){                                     echo '<div class="error">DB Error :' . $mysqli->error . '</div>';                                     die;                                }                                $rows5 = $results5->fetch_assoc();                                $query6 = "select count(*) as c from candidateupdatedplacementinfo where candidateid =".$candidateID.                                    " and placementid = ".$rows5['id'];                                $results6 = $mysqli->query($query6);                                if (!$results6 ){                                     echo '<div class="error">DB Error Query6:' . $mysqli->error . '</div>';                                     die;                                 }                                $rows6 = $results6->fetch_assoc();                                // if candidate-placement record not available in intermediary table, insert new                                if ($rows6["c"] == 0) {                                    $query7 = "insert into candidateupdatedplacementinfo(candidateid,placementid,wrkdesignation,wrkemail,wrkphone,wrkstreetaddress,wrkcity,wrkstate,wrkzip,mgrname,mgremail,mgrphone,hiringmgrname,hiringmgremail,hiringmgrphone,projectname,projectdesc,approved) values (".$candidateID.",".$rows5['id'].",'".$wrkdesignation."','".                                              $wrkemail."','".$wrkphone."','".$wrkstreetaddress."','"                                              .$wrkcity."','".$wrkstate."','".$wrkzip."','"                                             .$mgrname."','".$mgremail."','".$mgrphone."','"                                             .$hiringmgrname."','".$hiringmgremail."','".$hiringmgrphone."','".$projectname."','".$projectdesc."','"."N')";                                    $results7 = $mysqli->query($query7);                                    if (!$results7 ){                                       echo '<div class="error">DB Error Query7:' . $mysqli->error . '</div>';                                       die;                                    } else                                        echo '<div class="success">Thanks for updating. The information will be verified by HR Admin soon.</div>';                                    die;                                }                                // if candidate-placement record already available in intermediary table, update old                                else{                                    $query8 = "update candidateupdatedplacementinfo set wrkdesignation = '".$wrkdesignation.                                    "',wrkemail = '".$wrkemail.                                    "',wrkphone = '".$wrkphone.                                    "',wrkstreetaddress = '".$wrkstreetaddress.                                    "',wrkcity = '".$wrkcity.                                    "',wrkstate = '".$wrkstate.                                    "',wrkzip = '".$wrkzip.                                    "',mgrname = '".$mgrname.                                    "',mgremail = '".$mgremail.                                    "',mgrphone =' ".$mgrphone.                                    "',hiringmgrname =' ".$hiringmgrname.                                    "',hiringmgremail ='".$hiringmgremail.                                    "',hiringmgrphone =' ".$hiringmgrphone.                                    "',projectname ='".$projectname.                                    "',projectdesc =' ".$projectdesc.                                    "',approved = 'N' where candidateid = ".$candidateID." and placementid = ".$rows5['id'];                                     if (!$mysqli->query($query8)) {                                        echo '<div class="error">DB Error Query8:' . $mysqli->error . '</div>';                                    } else                                        echo '<div class="success">Thanks for updating. The information will be verified by HR Admin soon.</div>';                                    die;                                }                             }                                 break;            }?>            <form action="can-postplacement-infomgmt.php" id="form1" name="form1" method="post"  enctype="multipart/form-data">            <div>                <h3>Personal Information</h3>                <hr>                <br/>                <p>Name: <?php echo $rows1["name"] ?></p>                <p>Email: <?php echo $rows1["email"] ?> </p>                <p>Phone: <?php echo $rows1["phone"] ?></p>                <br/>                <br/>                <h3>Work Information</h3>                <hr>                <br/>             <label class='label-align' for="designation">Work Designation:</label>                <input style="width:300px" type='text' name='designation' id='designation' value='<?php echo $rows["wrkdesignation"] ?>' required/>                <br/><br/>                <label class='label-align' for="wrkemail">Work Email:</label>                <input style="width:300px" type='email' name='wrkemail' id='wrkemail' value='<?php echo $rows["wrkemail"] ?>' required/>                <br/><br/>                <label class='label-align' for="wrkphone">Work Phone:</label>                <input style="width:300px" type='tel' maxlength="12" name='wrkphone' id='wrkphone' value='<?php echo $rows["wrkphone"] ?>' required/> xxx-xxx-xxxx                <br/><br/>                <label class='label-align' for="streetaddress">Work Street Address:</label>                <input style="width:300px" type='text' name='wrkstreetaddress' id='wrkstreetaddress' value='<?php echo $rows["wrkstreetaddress"] ?>' required/>                <br/><br/>                <label class='label-align' for="city">Work City:</label>                <input style="width:300px" type='text' maxlength="20" name='wrkcity' id='wrkcity' value='<?php echo $rows["wrkcity"] ?>' required/>                <br/><br/>                <label class='label-align' for="state">Work State:</label>                <input style="width:300px" type='text' maxlength="2" name='wrkstate' id='wrkstate' value='<?php echo $rows["wrkstate"] ?>' required/>                <br/><br/>                <label class='label-align' for="zip">Work Zip:</label>                <input style="width:300px" type='text' maxlength="5" name='wrkzip' id='wrkzip' value='<?php echo $rows["wrkzip"] ?>' required/>                <br/><br/>                <label class='label-align' for="mgrname">Manager Name:</label>                <input style="width:300px" type='text' name='mgrname' id='mgrname' value='<?php echo $rows["mgrname"] ?>' required/>                <br/><br/>                <label class='label-align' for="mgremail">Manager Email:</label>                <input style="width:300px" type='email' name='mgremail' id='mgremail' value='<?php echo $rows["mgremail"] ?>' required/>                <br/><br/>                <label class='label-align' for="mgrphone">Manager Phone:</label>                <input style="width:300px" type='tel' maxlength="12" name='mgrphone' id='mgrphone' value='<?php echo $rows["mgrphone"] ?>' required/> xxx-xxx-xxxx                <br/><br/><br/>                <h3>Vendor Information</h3>                <hr>                <br/>                <label class='label-align' for="hiringmgrname">Hiring Manager Name:</label>                <input style="width:300px" type='text' name='hiringmgrname' id='hiringmgrname' value='<?php echo $rows["hiringmgrname"] ?>' required/>                <br/><br/>                <label class='label-align' for="hiringmgremail">Hiring Manager Email:</label>                <input style="width:300px" type='email' name='hiringmgremail' id='hiringmgremail' value='<?php echo $rows["hiringmgremail"]?>' required/>                <br/><br/>                <label class='label-align' for="hiringmgrphone">Hiring Manager Phone:</label>                <input style="width:300px" type='tel' maxlength="12" name='hiringmgrphone' id='hiringmgrphone' value='<?php echo $rows["hiringmgrphone"] ?>' required/> xxx-xxx-xxxx                <br/><br/><br/>                <h3>Project Information</h3>                <hr>                <br/>                <label class='label-align' for="projectname">Project Name :</label>                <input style="width:300px" type='text' name='projectname' id='projectname' value='<?php echo $rows["projectname"] ?>' required/>                <br/><br/>                <label class='label-align' for="projectdesc">Project Description:</label>                <textarea rows="10" cols="80" name='projectdesc' id='projectdesc' ><?php echo $rows["projectdesc"] ?></textarea>                <br/><br/>                <h3>Feedback</h3>                <hr>                <br/><br/>                <label class='label-align' for="trainingfb">Training :</label>                <textarea rows="10" cols="80" name='trainingfb' id='trainingfb' ><?php echo $rows["trainingfb"] ?></textarea>                <div class='centerbuttons'>                <input  type="submit" name="submit" value="Update"/></div>                <br/><br/><br/>            </form>        </div>        </div>        <div id='bottom'></div>    </div>   </div>    <br />    <br /></body></html><?php $mysqli->close();?>