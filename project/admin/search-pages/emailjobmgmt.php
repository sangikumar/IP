<?php/** * Email Job Management creates reusable email jobs * User: Shilpi * Date: 1/13/2015 * Time: 3:30 PM */require_once('../../postageapp_class.inc');require_once("../models/config.php");include_once ("../../ip-config.php");if (!securePage($_SERVER['PHP_SELF'])){die();}$userId = $loggedInUser->user_id;$candidateID = $loggedInUser->candidateid;if(!userIdExists($userId)){    header("Location:login.php"); die();}?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns='http://www.w3.org/1999/xhtml'><head>    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />    <title>Email Management</title>    <script src='models/funcs.js' type='text/javascript'></script>    <link rel='stylesheet' href='http://code.jquery.com/ui/1.10.3/themes/start/jquery-ui.css' />    <link rel='stylesheet' type='text/css' media='screen' href='/project/themes/ui.jqgrid.css'  />    <link rel='stylesheet' type='text/css' media='screen' href='/project/themes/ui.multiselect.css'/>    <link href='models/site-templates/default.css' rel='stylesheet' type='text/css' />    <link rel='stylesheet' href='http://gregfranko.com/jquery.selectBoxIt.js/css/jquery.selectBoxIt.css' />    <script src='http://code.jquery.com/jquery-1.9.1.js'></script>    <script src='http://code.jquery.com/ui/1.10.3/jquery-ui.js'></script>    <script src='exam/js/i18n/grid.locale-en.js' type='text/javascript'></script>    <script src='models/funcs.js'  type='text/javascript'></script>    <script src='http://gregfranko.com/jquery.selectBoxIt.js/js/jquery.selectBoxIt.min.js'></script>    <script src='exam/js/jquery.jqGrid.min.js' type='text/javascript'></script>    <script type="text/javascript" src="myjs/jHtmlArea-0.8.js"></script>    <link rel="Stylesheet" type="text/css" href="mystyle/jHtmlArea.css" />    <script>   $(function() {            $( '#mymenu' ).menu();            $('input').addClass('ui-corner-all');   });    </script>    <style>  .ui-menu { width: 130px; }  </style>    <script type='text/javascript'>        //<![CDATA[        $(document).ready(function(){            $('.link').button();            $('#mymenu').menu();            $('select').selectBoxIt();            $('input').addClass('inputs');            $("select#template").change(function(){                var templateid = $("select#template option:selected").attr('value');                $.get("../ajax-content/get-email-jobs.php" ,                    {templateid:templateid},                    function(data){                        $("#show_textarea").html(data);                        $("#txtDefaultHtmlArea").htmlarea({                            toolbar: ["html", "|",                                "forecolor",  // <-- Add the "forecolor" Toolbar Button                                "|", "bold", "italic", "underline", "|",                                "increasefontsize","decreasefontsize" ,"|",                                "orderedList" , "unorderedList" ,"|",                                "indent","outdent","|",                                "p", "h1", "h2", "h3", "|",                                "link", "unlink" ,"image","horizontalrule"] // Overrides/Specifies the Toolbar buttons to show                        });                    });            });            $("select#group").change(function(){            //    if ($("input#showemaillist").is(':checked')) {                    var groupid = $("select#group option:selected").attr('value');                    $.get("../ajax-content/get-email-jobs.php",                        {groupid: groupid},                        function (data) {                            $("#show_emailarea").html(data);                            $("#txtEmailArea").resizable();                        });           //     }            });        });        //]]>    </script></head><body><div id='wrapper'>    <div id='top'><div id='logo'></div><div id='logo1'></div></div>    <div id='content'>        <h2>Email Management</h2>        <br />        <div id='left-nav'>    <?phpinclude($_SERVER["DOCUMENT_ROOT"] ."left-nav.php");?>        </div>        <div id='main'><?phpif (!empty($_POST)) {    $templateid = $_POST['template'];    $groupid = $_POST['group'];    $engine = $_POST['engine'];    $subject = $_POST['subject'];    $to = $_POST['to'];    $from = $_POST['from'];    $emaillist = $_POST['txtEmailArea'];    $newhtmlcode = $_POST['txtDefaultHtmlArea'];    $newhtmlcode = str_replace('\"',' ',$newhtmlcode);    // Converting Comma Separated Emails to Array of Emails to get BCC effect using PostageAPP    $recipient = explode(",",$emaillist);    array_push($recipient, $to);    // To and From fields are cosmetic. The actual emails going are in recipient list    if (empty($to)) {        $to = 'no-reply@innova-path.com';    }    if (empty($from))        $from = 'no-reply@innova-path.com';    // Setup some headers    $header = array(        'From' => $from,        'Reply-to' => $from    );    // The body of the message    $mail_body = array(        'text/plain' => ' ',        'text/html' => $newhtmlcode    );    // Send it all    $ret = PostageApp::mailTo($to, $recipient, $subject, $mail_body, $header);    // Checkout the response    if ($ret->response->status == 'ok') {        echo '<div class="info">SUCCESS: The email is sent.</div>';    } else {        echo '<div class="error">Error sending your email:' . $ret->response->message.'</div>';    } }    ?>            <form action="emailjobmgmt.php" id="form1" name="form1" method="post"  enctype="multipart/form-data">                    <div><label class="label-align">Template</label>                          <select  name="template"  id="template" size="3">                                <?php                                $query = 'select id, name from ip_email_templates order by name';                                $results = $mysqli->query($query);                                ?>                                <option value="0">- Select -</option>                                <option value="1000000">Blank Template</option>                                <?php                                while ($rows = $results->fetch_assoc())                                {?>                                    <option value="<?php echo $rows['id'];?>"><?php echo $rows['name'];?></option>                                <?php                                }?>                            </select>                    </div><br/>                    <div>                        <label class="label-align">Group</label>                        <select  name="group"  id="group">                                <?php                                $query = 'select id, name from ip_email_group order by name';                                $results = $mysqli->query($query);                                ?>                                <option value="0">- Select -</option>                                <option value="1000000">Custom Group</option>                                <?php                                while ($rows = $results->fetch_assoc())                                {?>                                    <option value="<?php echo $rows['id'];?>"><?php echo $rows['name'];?></option>                                <?php                                }?>                            </select>                    </div>                    </br>                    <div>                        <label class="label-align">Engine</label>                        <select  name="engine"  id="engine">                                <option value="0">- Select -</option>                                <?php                                foreach($emailengine as $key => $value) {                                ?>                                    <option value="<?php echo $key;?>"><?php echo $value;?></option>                                <?php                                }?>                            </select>                    </div>                   <br/>                    <div id="show_emailarea"></div>                   <br/>                    <div id="show_textarea"></div>            </form>        </div>        <div id='bottom'></div>    </div>    <br />    <br /></body></html><?php     $mysqli->close();?>